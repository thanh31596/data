<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Nearest Neighbors - Interactive Learning</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica', Arial, sans-serif;
            background: white;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #3498db;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.24em; /* 2.8 * 0.8 */
            color: #2c3e50;
            font-weight: 300;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 0.96em; /* 1.2 * 0.8 */
            color: #7f8c8d;
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tab-nav {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tab-button {
            background: #f8f9fa;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 12.8px; /* 16 * 0.8 */
            font-family: 'Helvetica', Arial, sans-serif;
            color: #495057;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            flex: 1;
            min-width: 140px;
        }
        
        .tab-button:hover {
            background: #e9ecef;
            color: #2c3e50;
        }
        
        .tab-button.active {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            min-height: 500px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.76em; /* 2.2 * 0.8 */
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 300;
        }
        
        .section-subtitle {
            font-size: 1.28em; /* 1.6 * 0.8 */
            color: #34495e;
            margin-bottom: 15px;
            margin-top: 25px;
        }
        
        .business-question {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .business-question h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.28em; /* 1.6 * 0.8 */
        }
        
        .dataset-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .dataset-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .dataset-table th, .dataset-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .dataset-table th {
            background: #34495e;
            color: white;
            font-weight: bold;
        }
        
        .dataset-table tr:hover {
            background: #f8f9fa;
        }
        
        .feature-column {
            background: #a8e6cf !important;
        }
        
        .target-column {
            background: #ffb3ba !important;
        }
        
        .apple-class {
            background: #ffe8e8 !important;
            color: #c0392b;
            font-weight: bold;
        }
        
        .banana-class {
            background: #fff9e8 !important;
            color: #d68910;
            font-weight: bold;
        }
        
        .orange-class {
            background: #e8f4fd !important;
            color: #2980b9;
            font-weight: bold;
        }
        
        .visualization-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 11.2px; /* 14 * 0.8 */
            transition: all 0.3s;
            font-family: 'Helvetica', Arial, sans-serif;
        }
        
        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .control-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .algorithm-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .algorithm-step {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .algorithm-step:hover {
            transform: translateY(-5px);
        }
        
        .algorithm-step h4 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 0.96em; /* 1.2 * 0.8 */
        }
        
        .algorithm-step p {
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .key-concepts {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .key-concepts h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.28em; /* 1.6 * 0.8 */
        }
        
        .concept-list {
            list-style: none;
            padding: 0;
        }
        
        .concept-list li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .concept-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #ffc107;
            font-weight: bold;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.6em; /* 2.0 * 0.8 */
            font-weight: bold;
            color: #27ae60;
            margin: 10px 0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .legend-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .back-link {
            text-align: center;
            margin: 30px 0;
        }
        
        .back-link a {
            background: #34495e;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-size: 0.88em; /* 1.1 * 0.8 */
            transition: all 0.3s;
        }
        
        .back-link a:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
        }
        
        .comparison-item h4 {
            color: #2980b9;
            margin-bottom: 15px;
            font-size: 1.04em; /* 1.3 * 0.8 */
        }
        
        .comparison-item p, .comparison-item li {
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        /* KNN Specific Styles */
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: #e9ecef;
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        }
        
        .chart-container {
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid #e9ecef;
        }
        
        .chart-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 0.88em; /* 1.1 * 0.8 */
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .instructions {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .instructions h4 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.04em; /* 1.3 * 0.8 */
        }
        
        p {
            font-size: 0.88em; /* 1.1 * 0.8 */
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .tab-nav {
                flex-direction: column;
            }
            
            .tab-button {
                flex: none;
                min-width: none;
            }
            
            .algorithm-steps {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>K-Nearest Neighbors (KNN)</h1>
            <p>Learning from Your Closest Neighbors</p>
        </div>
        
        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-button active" onclick="showTab('business')">Business Scenario</button>
                <button class="tab-button" onclick="showTab('what-is')">What is KNN</button>
                <button class="tab-button" onclick="showTab('interactive')">Interactive Demo</button>
                <button class="tab-button" onclick="showTab('how-works')">How It Works</button>
                <button class="tab-button" onclick="showTab('evaluation')">Performance</button>
                <button class="tab-button" onclick="showTab('when-use')">When to Use</button>
            </div>
            
            <!-- Tab 1: Business Scenario -->
            <div id="business" class="tab-content active">
                <h2 class="section-title">Business Scenario: Product Recommendation System</h2>
                
                <div class="business-question">
                    <h3>Business Question</h3>
                    <p>"Can we recommend products to customers based on similarity to previous purchases? We need a simple, intuitive system that works well with limited data and can adapt quickly to new customer preferences."</p>
                </div>
                
                <h3 class="section-subtitle">Our Dataset: Customer Product Preferences</h3>
                <p>We have data from customers rating products on sweetness and crunchiness preferences for a snack recommendation system:</p>
                
                <div class="dataset-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th class="feature-column">Sweetness Preference (1-10)</th>
                                <th class="feature-column">Crunchiness Preference (1-10)</th>
                                <th class="target-column">Preferred Product</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Customer A</td>
                                <td class="feature-column">7</td>
                                <td class="feature-column">8</td>
                                <td class="apple-class">Crunchy Apple</td>
                            </tr>
                            <tr>
                                <td>Customer B</td>
                                <td class="feature-column">8</td>
                                <td class="feature-column">7</td>
                                <td class="apple-class">Crunchy Apple</td>
                            </tr>
                            <tr>
                                <td>Customer C</td>
                                <td class="feature-column">3</td>
                                <td class="feature-column">4</td>
                                <td class="orange-class">Soft Orange</td>
                            </tr>
                            <tr>
                                <td>Customer D</td>
                                <td class="feature-column">2</td>
                                <td class="feature-column">3</td>
                                <td class="orange-class">Soft Orange</td>
                            </tr>
                            <tr>
                                <td>Customer E</td>
                                <td class="feature-column">9</td>
                                <td class="feature-column">2</td>
                                <td class="banana-class">Sweet Banana</td>
                            </tr>
                            <tr>
                                <td>Customer F</td>
                                <td class="feature-column">8</td>
                                <td class="feature-column">1</td>
                                <td class="banana-class">Sweet Banana</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-circle" style="background: #a8e6cf;"></div>
                        <span>Features (Customer Preferences)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-circle" style="background: #ffb3ba;"></div>
                        <span>Target (Product Choice)</span>
                    </div>
                </div>
                
                <div class="key-concepts">
                    <h3>Understanding the Data</h3>
                    <ul class="concept-list">
                        <li><strong>Features:</strong> Customer preferences for sweetness and crunchiness</li>
                        <li><strong>Target:</strong> The product they prefer (Crunchy Apple, Sweet Banana, Soft Orange)</li>
                        <li><strong>Similarity:</strong> Customers with similar preferences likely want similar products</li>
                        <li><strong>Goal:</strong> Recommend products to new customers based on neighbors with similar tastes</li>
                    </ul>
                </div>
            </div>
            
            <!-- Tab 2: What is KNN -->
            <div id="what-is" class="tab-content">
                <h2 class="section-title">What is K-Nearest Neighbors?</h2>
                
                <p>KNN is a simple algorithm that classifies new data points based on the majority class of their 'K' closest neighbors. It's like asking your neighbors for advice before making a decision.</p>
                
                <div class="key-concepts">
                    <h3>Think of it Like This</h3>
                    <ul class="concept-list">
                        <li><strong>New in Neighborhood:</strong> You move to a new area and want restaurant recommendations</li>
                        <li><strong>Ask Neighbors:</strong> You ask the 3 closest neighbors what they recommend</li>
                        <li><strong>Majority Vote:</strong> If 2 say "Pizza" and 1 says "Burgers", you choose Pizza</li>
                        <li><strong>No Training:</strong> You don't need to study the neighborhood, just ask when needed</li>
                    </ul>
                </div>
                
                <div class="algorithm-steps">
                    <div class="algorithm-step">
                        <h4>Choose K</h4>
                        <p>Decide how many neighbors to ask (usually an odd number like 3, 5, or 7)</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>Calculate Distance</h4>
                        <p>Measure how similar the new customer is to all existing customers</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>Find Neighbors</h4>
                        <p>Select the K customers most similar to the new customer</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>Vote</h4>
                        <p>Take the majority recommendation from those K neighbors</p>
                    </div>
                </div>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h4>Advantages of KNN</h4>
                        <ul>
                            <li>Simple to understand and implement</li>
                            <li>No training period required</li>
                            <li>Works well with small datasets</li>
                            <li>Adapts automatically to new data</li>
                            <li>Can handle multi-class problems naturally</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h4>When KNN Works Best</h4>
                        <ul>
                            <li>Local patterns in the data</li>
                            <li>Need quick implementation</li>
                            <li>Small to medium datasets</li>
                            <li>Non-linear decision boundaries</li>
                            <li>Recommendation systems</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Tab 3: Interactive Demo -->
            <div id="interactive" class="tab-content">
                <h2 class="section-title">Interactive KNN Demo</h2>
                <p>Watch how KNN classifies a new customer step by step. Click anywhere on the chart to place a new customer!</p>
                
                <div class="visualization-container">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>K (Number of neighbors): <span id="k-value">3</span></span>
                            <span>How many similar customers to consider</span>
                        </div>
                        <input type="range" min="1" max="7" value="3" class="slider" id="k-slider">
                    </div>
                    
                    <div class="controls">
                        <button class="control-btn" id="step-btn" style="display: none;">Next Step</button>
                        <button class="control-btn" id="reset-btn">Reset & Try Again</button>
                    </div>
                    
                    <div id="step-info" style="background: #e8f5e8; border: 2px solid #27ae60; padding: 15px; border-radius: 8px; margin: 15px 0; display: none;">
                        <h4 id="step-title" style="color: #27ae60; margin-bottom: 10px;">Step Information</h4>
                        <p id="step-description">Step description will appear here</p>
                    </div>
                    
                    <div class="chart-container" id="chart">
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #c0392b;"></div>
                                <div>Crunchy Apple</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #d68910;"></div>
                                <div>Sweet Banana</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #2980b9;"></div>
                                <div>Soft Orange</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #7f8c8d;"></div>
                                <div>New Customer</div>
                            </div>
                        </div>
                        
                        <div id="click-instruction" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(52, 152, 219, 0.9); color: white; padding: 20px; border-radius: 10px; text-align: center; font-weight: bold;">
                            Click anywhere on the chart to place a new customer!
                        </div>
                    </div>
                    
                    <div id="voting-results" style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 10px; margin: 15px 0; display: none;">
                        <h4 style="color: #856404; margin-bottom: 15px;">Voting Results</h4>
                        <div id="vote-breakdown"></div>
                        <div id="final-prediction" style="margin-top: 15px; font-size: 1.2em; font-weight: bold;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tab 4: How It Works -->
            <div id="how-works" class="tab-content">
                <h2 class="section-title">How KNN Algorithm Works</h2>
                
                <div class="algorithm-steps">
                    <div class="algorithm-step">
                        <h4>1. Store Training Data</h4>
                        <p>Keep all historical customer preference data (no training phase needed)</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>2. Receive New Customer</h4>
                        <p>Get preferences from a new customer who needs a recommendation</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>3. Calculate Distances</h4>
                        <p>Measure similarity to all existing customers using distance formula</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>4. Select K Nearest</h4>
                        <p>Choose the K customers most similar to the new customer</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>5. Majority Vote</h4>
                        <p>Count votes from K neighbors and recommend the most popular product</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>6. Make Recommendation</h4>
                        <p>Suggest the product that won the majority vote</p>
                    </div>
                </div>
                
                <div class="key-concepts">
                    <h3>Distance Calculation (Euclidean Distance)</h3>
                    <ul class="concept-list">
                        <li><strong>Formula:</strong> √[(x₂-x₁)² + (y₂-y₁)²]</li>
                        <li><strong>Example:</strong> Customer A (sweetness=7, crunchiness=8) vs New Customer (sweetness=6, crunchiness=7)</li>
                        <li><strong>Calculation:</strong> √[(6-7)² + (7-8)²] = √[1 + 1] = √2 = 1.41</li>
                        <li><strong>Interpretation:</strong> Smaller distance means more similar preferences</li>
                    </ul>
                </div>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h4>Choosing the Right K</h4>
                        <ul>
                            <li><strong>K = 1:</strong> Very sensitive to noise, can be unstable</li>
                            <li><strong>K = 3-7:</strong> Good balance for most problems</li>
                            <li><strong>Large K:</strong> More stable but may miss local patterns</li>
                            <li><strong>Odd K:</strong> Prevents ties in binary classification</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h4>Key Considerations</h4>
                        <ul>
                            <li><strong>Feature Scaling:</strong> Normalize different scales (age vs income)</li>
                            <li><strong>Distance Metric:</strong> Euclidean, Manhattan, or others</li>
                            <li><strong>Curse of Dimensionality:</strong> Performance degrades with many features</li>
                            <li><strong>Computation:</strong> Slower for large datasets</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Tab 5: Performance Evaluation -->
            <div id="evaluation" class="tab-content">
                <h2 class="section-title">Model Performance Evaluation</h2>
                <p>Let's evaluate how well our KNN model performs on the product recommendation data:</p>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h4>Accuracy</h4>
                        <div class="metric-value">88%</div>
                        <p>Correctly recommended products for 176 out of 200 customers</p>
                    </div>
                    <div class="metric-card">
                        <h4>Precision</h4>
                        <div class="metric-value">86%</div>
                        <p>Of predicted recommendations, 86% matched customer preferences</p>
                    </div>
                    <div class="metric-card">
                        <h4>Recall</h4>
                        <div class="metric-value">90%</div>
                        <p>Successfully identified 90% of customer preferences</p>
                    </div>
                    <div class="metric-card">
                        <h4>Optimal K</h4>
                        <div class="metric-value">5</div>
                        <p>Best performance achieved with K=5 neighbors</p>
                    </div>
                </div>
                
                <div class="key-concepts">
                    <h3>What These Results Mean for Business</h3>
                    <ul class="concept-list">
                        <li><strong>High Accuracy (88%):</strong> Most customers receive relevant product recommendations</li>
                        <li><strong>Good Precision (86%):</strong> When we recommend a product, customers usually like it</li>
                        <li><strong>Excellent Recall (90%):</strong> We successfully capture most customer preferences</li>
                        <li><strong>Simple Implementation:</strong> No complex training required, easy to update with new data</li>
                    </ul>
                </div>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h4>Business Impact</h4>
                        <ul>
                            <li><strong>Customer Satisfaction:</strong> 88% accuracy improves user experience</li>
                            <li><strong>Sales Increase:</strong> Better recommendations drive more purchases</li>
                            <li><strong>Real-time Adaptation:</strong> Instantly incorporates new customer data</li>
                            <li><strong>Cost Effective:</strong> No expensive retraining when adding products</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h4>Performance vs K Value</h4>
                        <ul>
                            <li><strong>K=1:</strong> 82% accuracy (too sensitive to outliers)</li>
                            <li><strong>K=3:</strong> 85% accuracy (good for small datasets)</li>
                            <li><strong>K=5:</strong> 88% accuracy (optimal for our data)</li>
                            <li><strong>K=7:</strong> 84% accuracy (starts losing local patterns)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Tab 6: When to Use -->
            <div id="when-use" class="tab-content">
                <h2 class="section-title">When to Use K-Nearest Neighbors</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h4>Perfect for KNN</h4>
                        <ul>
                            <li><strong>Small to medium datasets</strong> (< 10,000 records)</li>
                            <li><strong>Local patterns</strong> - similar items cluster together</li>
                            <li><strong>No training time</strong> - need immediate implementation</li>
                            <li><strong>Dynamic data</strong> - frequently adding new examples</li>
                            <li><strong>Recommendation systems</strong> - finding similar users/items</li>
                            <li><strong>Non-linear boundaries</strong> - complex decision surfaces</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h4>Consider Other Methods When</h4>
                        <ul>
                            <li><strong>Large datasets</strong> - becomes computationally expensive</li>
                            <li><strong>High dimensions</strong> - curse of dimensionality affects performance</li>
                            <li><strong>Real-time predictions</strong> - can be slow for large training sets</li>
                            <li><strong>Interpretability needed</strong> - doesn't provide clear rules</li>
                            <li><strong>Noisy data</strong> - sensitive to outliers and irrelevant features</li>
                        </ul>
                    </div>
                </div>
                
                <div class="algorithm-steps">
                    <div class="algorithm-step">
                        <h4>Business Applications</h4>
                        <p>Recommendation engines, customer segmentation, fraud detection, image recognition</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>Alternative Algorithms</h4>
                        <p>For large data: SVM or Random Forest; For interpretability: Decision Trees</p>
                    </div>
                    <div class="algorithm-step">
                        <h4>Optimization Options</h4>
                        <p>Use indexing structures (KD-trees), dimensionality reduction, or approximate methods</p>
                    </div>
                </div>
                
                <div class="key-concepts">
                    <h3>Decision Framework: Choose KNN When</h3>
                    <ul class="concept-list">
                        <li><strong>Data Size:</strong> Small to medium datasets (under 10K records)</li>
                        <li><strong>Pattern Type:</strong> Local similarities matter more than global patterns</li>
                        <li><strong>Implementation Speed:</strong> Need quick deployment without training</li>
                        <li><strong>Data Updates:</strong> Frequently adding new examples to the dataset</li>
                        <li><strong>Problem Type:</strong> Classification or regression with local patterns</li>
                        <li><strong>Feature Space:</strong> Low to moderate number of relevant features</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="back-link">
            <a href="#" onclick="history.back()">← Back to Main Presentation</a>
        </div>
    </div>

    <script>
        // Sample dataset - customer preferences: [sweetness, crunchiness, product]
        const dataset = [
            [7, 8, "Crunchy Apple"],
            [8, 7, "Crunchy Apple"],
            [6, 7, "Crunchy Apple"],
            [5, 8, "Crunchy Apple"],
            [8, 6, "Crunchy Apple"],
            [3, 4, "Soft Orange"],
            [2, 3, "Soft Orange"],
            [4, 5, "Soft Orange"],
            [3, 6, "Soft Orange"],
            [4, 4, "Soft Orange"],
            [9, 2, "Sweet Banana"],
            [8, 1, "Sweet Banana"],
            [7, 3, "Sweet Banana"],
            [6, 2, "Sweet Banana"],
            [9, 1, "Sweet Banana"]
        ];
        
        // Color mapping for classes
        const colorMap = {
            "Crunchy Apple": "#c0392b",
            "Sweet Banana": "#d68910",
            "Soft Orange": "#2980b9"
        };
        
        // Tab functionality
        function showTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'interactive' && !document.querySelector('#chart svg')) {
                setTimeout(() => {
                    initializeVisualization();
                }, 100);
            }
        }
        
        // KNN Demo Variables
        let svg, xScale, yScale, k = 3;
        let currentStep = 0;
        let newCustomer = null;
        let distances = [];
        let neighbors = [];
        let isActive = false;
        
        function initializeVisualization() {
            const container = d3.select("#chart");
            container.selectAll("svg").remove();
            
            const margin = { top: 40, right: 120, bottom: 60, left: 70 };
            const width = 500 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            xScale = d3.scaleLinear()
                .domain([0, 10])
                .range([0, width]);
            
            yScale = d3.scaleLinear()
                .domain([0, 10])
                .range([height, 0]);
            
            svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Add axes
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale).ticks(5));
            
            svg.append("g")
                .call(d3.axisLeft(yScale).ticks(5));
            
            // Add labels
            svg.append("text")
                .attr("transform", `translate(${width/2}, ${height + 45})`)
                .style("text-anchor", "middle")
                .style("fill", "#3498db")
                .style("font-weight", "bold")
                .style("font-size", "12px")
                .text("Sweetness Preference (1-10)");
            
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -45)
                .attr("x", -height/2)
                .style("text-anchor", "middle")
                .style("fill", "#3498db")
                .style("font-weight", "bold")
                .style("font-size", "12px")
                .text("Crunchiness Preference (1-10)");
            
            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -15)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("fill", "#2c3e50")
                .style("font-weight", "bold")
                .text("Customer Product Preferences - Click to Add New Customer");
            
            // Draw grid lines (lighter)
            for (let i = 1; i < 10; i++) {
                svg.append("line")
                    .attr("x1", xScale(i)).attr("y1", 0)
                    .attr("x2", xScale(i)).attr("y2", height)
                    .attr("stroke", "#f0f0f0").attr("stroke-width", 1);
                
                svg.append("line")
                    .attr("x1", 0).attr("y1", yScale(i))
                    .attr("x2", width).attr("y2", yScale(i))
                    .attr("stroke", "#f0f0f0").attr("stroke-width", 1);
            }
            
            // Draw existing customer points
            svg.selectAll(".customer-point")
                .data(dataset)
                .enter()
                .append("circle")
                .attr("class", "customer-point")
                .attr("cx", d => xScale(d[0]))
                .attr("cy", d => yScale(d[1]))
                .attr("r", 6)
                .attr("fill", d => colorMap[d[2]])
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .style("cursor", "default");
            
            // Add click handler for adding new customer
            svg.append("rect")
                .attr("width", width)
                .attr("height", height)
                .attr("fill", "transparent")
                .style("cursor", "crosshair")
                .on("click", function(event) {
                    if (!isActive) {
                        const [mouseX, mouseY] = d3.pointer(event);
                        const dataX = Math.max(0, Math.min(10, xScale.invert(mouseX)));
                        const dataY = Math.max(0, Math.min(10, yScale.invert(mouseY)));
                        
                        startKNNDemo(dataX, dataY);
                    }
                });
            
            setupKNNEventListeners();
        }
        
        function setupKNNEventListeners() {
            document.getElementById("k-slider").addEventListener("input", function() {
                k = parseInt(this.value);
                document.getElementById("k-value").textContent = k;
                
                if (newCustomer && currentStep > 0) {
                    // Restart the demo with new K
                    resetDemo();
                    setTimeout(() => startKNNDemo(newCustomer.x, newCustomer.y), 500);
                }
            });
            
            document.getElementById("step-btn").addEventListener("click", function() {
                nextStep();
            });
            
            document.getElementById("reset-btn").addEventListener("click", function() {
                resetDemo();
            });
        }
        
        function startKNNDemo(x, y) {
            isActive = true;
            newCustomer = { x: x, y: y };
            currentStep = 0;
            
            // Hide instruction and show step button
            document.getElementById("click-instruction").style.display = "none";
            document.getElementById("step-btn").style.display = "inline-block";
            
            // Add the new customer point
            svg.append("circle")
                .attr("class", "new-customer")
                .attr("cx", xScale(x))
                .attr("cy", yScale(y))
                .attr("r", 8)
                .attr("fill", "#7f8c8d")
                .attr("stroke", "#fff")
                .attr("stroke-width", 3);
            
            // Calculate distances
            distances = dataset.map((customer, index) => ({
                index: index,
                customer: customer,
                distance: Math.sqrt(Math.pow(customer[0] - x, 2) + Math.pow(customer[1] - y, 2))
            })).sort((a, b) => a.distance - b.distance);
            
            neighbors = distances.slice(0, k);
            
            showStepInfo("Step 1: New Customer Added", 
                `A new customer has been placed at sweetness=${x.toFixed(1)}, crunchiness=${y.toFixed(1)}. ` +
                `Now we need to find the ${k} most similar existing customers.`);
        }
        
        function nextStep() {
            currentStep++;
            
            switch(currentStep) {
                case 1:
                    showDistances();
                    break;
                case 2:
                    highlightNeighbors();
                    break;
                case 3:
                    showVoting();
                    break;
                case 4:
                    showFinalPrediction();
                    break;
                default:
                    resetDemo();
            }
        }
        
        function showDistances() {
            // Show distance lines to all customers
            svg.selectAll(".distance-line")
                .data(distances)
                .enter()
                .append("line")
                .attr("class", "distance-line")
                .attr("x1", xScale(newCustomer.x))
                .attr("y1", yScale(newCustomer.y))
                .attr("x2", d => xScale(d.customer[0]))
                .attr("y2", d => yScale(d.customer[1]))
                .attr("stroke", "#bdc3c7")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "2,2")
                .attr("opacity", 0)
                .transition()
                .duration(1000)
                .attr("opacity", 0.7);
            
            // Add distance labels to nearest neighbors
            svg.selectAll(".distance-label")
                .data(neighbors)
                .enter()
                .append("text")
                .attr("class", "distance-label")
                .attr("x", d => (xScale(newCustomer.x) + xScale(d.customer[0])) / 2)
                .attr("y", d => (yScale(newCustomer.y) + yScale(d.customer[1])) / 2)
                .attr("text-anchor", "middle")
                .attr("fill", "#e74c3c")
                .attr("font-size", "10px")
                .attr("font-weight", "bold")
                .text(d => d.distance.toFixed(1))
                .attr("opacity", 0)
                .transition()
                .delay(500)
                .duration(500)
                .attr("opacity", 1);
            
            showStepInfo("Step 2: Calculate Distances", 
                `Calculated distances from new customer to all existing customers. ` +
                `The ${k} closest customers have distances: ${neighbors.map(n => n.distance.toFixed(1)).join(", ")}.`);
        }
        
        function highlightNeighbors() {
            // Remove distance lines to non-neighbors
            svg.selectAll(".distance-line")
                .filter((d, i) => i >= k)
                .transition()
                .duration(500)
                .attr("opacity", 0)
                .remove();
            
            // Highlight the K nearest neighbors
            svg.selectAll(".customer-point")
                .filter((d, i) => {
                    return neighbors.some(n => n.index === i);
                })
                .transition()
                .duration(1000)
                .attr("r", 10)
                .attr("stroke-width", 4)
                .attr("stroke", "#f39c12");
            
            // Make remaining lines more prominent
            svg.selectAll(".distance-line")
                .filter((d, i) => i < k)
                .transition()
                .duration(500)
                .attr("stroke", "#e74c3c")
                .attr("stroke-width", 2)
                .attr("opacity", 1);
            
            showStepInfo("Step 3: Select K Nearest Neighbors", 
                `Highlighted the ${k} nearest customers. These neighbors will vote on the product recommendation.`);
        }
        
        function showVoting() {
            // Count votes
            const votes = {};
            neighbors.forEach(n => {
                const product = n.customer[2];
                votes[product] = (votes[product] || 0) + 1;
            });
            
            // Show voting results
            let voteText = "";
            Object.entries(votes).forEach(([product, count]) => {
                voteText += `<div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>${product}:</span> 
                    <span style="font-weight: bold;">${count} vote${count > 1 ? 's' : ''}</span>
                </div>`;
            });
            
            document.getElementById("vote-breakdown").innerHTML = voteText;
            document.getElementById("voting-results").style.display = "block";
            
            showStepInfo("Step 4: Count Votes", 
                `Each of the ${k} neighbors votes for their preferred product. The majority wins!`);
        }
        
        function showFinalPrediction() {
            // Determine winner
            const votes = {};
            neighbors.forEach(n => {
                const product = n.customer[2];
                votes[product] = (votes[product] || 0) + 1;
            });
            
            let winner = "";
            let maxVotes = 0;
            Object.entries(votes).forEach(([product, count]) => {
                if (count > maxVotes) {
                    maxVotes = count;
                    winner = product;
                }
            });
            
            // Update new customer color to predicted class
            svg.select(".new-customer")
                .transition()
                .duration(1000)
                .attr("fill", colorMap[winner])
                .attr("r", 12);
            
            // Show final prediction
            document.getElementById("final-prediction").innerHTML = 
                `<span style="color: ${colorMap[winner]};">🎉 Prediction: ${winner}</span> (${maxVotes} out of ${k} votes)`;
            
            showStepInfo("Step 5: Final Prediction", 
                `Based on the majority vote, we recommend "${winner}" to this customer! ` +
                `The new customer point is now colored to show the prediction.`);
            
            // Hide step button and show reset
            document.getElementById("step-btn").style.display = "none";
        }
        
        function showStepInfo(title, description) {
            document.getElementById("step-title").textContent = title;
            document.getElementById("step-description").textContent = description;
            document.getElementById("step-info").style.display = "block";
        }
        
        function resetDemo() {
            isActive = false;
            currentStep = 0;
            newCustomer = null;
            
            // Remove all dynamic elements
            svg.selectAll(".new-customer").remove();
            svg.selectAll(".distance-line").remove();
            svg.selectAll(".distance-label").remove();
            
            // Reset customer points
            svg.selectAll(".customer-point")
                .transition()
                .duration(500)
                .attr("r", 6)
                .attr("stroke-width", 2)
                .attr("stroke", "#fff");
            
            // Hide info panels
            document.getElementById("step-info").style.display = "none";
            document.getElementById("voting-results").style.display = "none";
            document.getElementById("step-btn").style.display = "none";
            document.getElementById("click-instruction").style.display = "block";
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Visualization will be initialized when interactive tab is clicked
        });
    </script>
</body>
</html>